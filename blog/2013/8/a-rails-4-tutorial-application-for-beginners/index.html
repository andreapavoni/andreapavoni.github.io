<!DOCTYPE html>
<html>
  <head>
    <title>A rails 4 tutorial application for beginners - Andrea Pavoni</title>

    <meta charset=utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/assets/application.css">
    <link rel="canonical" href="http://andreapavoni.com/blog/2013/8/a-rails-4-tutorial-application-for-beginners" />

    <meta name="google-site-verification" content="4kYa-0E2vIOPdWtJsz0BISFUuNoswW-SyiDRvezrXmQ" />

    <meta name="author" content="Andrea Pavoni">
    <meta name="language" content="en">
    <meta name="description" content="This article was originally written for the [12 Devs of Summer](http://12devs.co.uk) and posted [here](http://12devs.co.uk/articles/writing-a-web-application-with-ruby-on-rails/). It was written for beginners, I described how to get up and running withRuby and Rails and I tried to offer an in depth look at what it’s like to work with it. In this tutorial, you'll create a simple *non Hello World* application."/>
    <meta name="keywords" content="andrea,pavoni,andrea pavoni,programmer,developer,rome,italy,ruby,javascript,go,golang,redis,oop,tdd,bdd,unix,open source,node,nodejs" />

    <meta property="fb:admins" content="1309293135" />
    <meta property="og:title" content="A rails 4 tutorial application for beginners - Andrea Pavoni" />
    <meta property="og:url" content="http://andreapavoni.com/blog/2013/8/a-rails-4-tutorial-application-for-beginners" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="http://www.gravatar.com/avatar/c96743368f88cd325e8ae414d267dbaa.png" />
    <meta property="twitter:card" content="summary" />
    <meta property="twitter:site" content="@apeacox" />
    <meta property="twitter:title" content="A rails 4 tutorial application for beginners - Andrea Pavoni" />
    <meta property="twitter:description" content="This article was originally written for the [12 Devs of Summer](http://12devs.co.uk) and posted [here](http://12devs.co.uk/articles/writing-a-web-application-with-ruby-on-rails/). It was written for beginners, I described how to get up and running withRuby and Rails and I tried to offer an in depth look at what it’s like to work with it. In this tutorial, you'll create a simple *non Hello World* application." />
    <meta property="twitter:image" content="http://www.gravatar.com/avatar/c96743368f88cd325e8ae414d267dbaa.png" />
    <meta property="twitter:url" content="http://andreapavoni.com/blog/2013/8/a-rails-4-tutorial-application-for-beginners" />

  </head>
  <body>
    <aside class="cover">
      <div class="inner">
        <div class="avatar">
          <img src='http://www.gravatar.com/avatar/c96743368f88cd325e8ae414d267dbaa.png?s=150' alt='Andrea Pavoni image' />
        </div>
        <h1 class="title"><a href="http://andreapavoni.com">Andrea Pavoni</a></h1>
        <p class="description">
          Passionate programmer. *nix user since 1999. Husband/Father. Teacher.
        </p>
        <p class="description">Developer</p>
        <ul class="contacts">
          <li><a href="http://github.com/apeacox/" class="fa fa-github fa-lg" title="github"></a></li>
          <li><a href="http://twitter.com/apeacox/" class="fa fa-twitter fa-lg" title="twitter"></a></li>
          <li><a href="http://it.linkedin.com/in/andreapavoni/" class="fa fa-linkedin fa-lg" title="LinkedIn"></a></li>
          <li><a href="https://plus.google.com/+AndreaPavoni?rel=author" class="fa fa-google-plus fa-lg" title="Google+"></a></li>
          <li><a href="http://www.facebook.com/apavoni" class="fa fa-facebook fa-lg" title="facebook"></a></li>
          <li><a href="http://instagram.com/apavoni" class="fa fa-instagram fa-lg" title="instagram"></a></li>
        </ul>
      </div>
    </aside>
    <section class="wrapper">
      <div class="wrapper-inner">
        <article class="post">
  <header>
    <p class="meta">20 Aug 2013</p>
    <h1 class="title"><a href="/blog/2013/8/a-rails-4-tutorial-application-for-beginners">A rails 4 tutorial application for beginners</a></h2>
  </header>

  <div class="content">
    

    <h2 id="intro">Intro</h2>

<p>Unless you lived under a rock in the past 5 years or so, you should have already heard of <a href="http://rubyonrails.org">Ruby on Rails</a>. In this article, we’ll write a very simple web application with it to show its power and speed of development.</p>

<p>We’ll cover the following topics:</p>

<ul>
  <li>install Ruby</li>
  <li>install the rails gem</li>
  <li>how to start a new rails project</li>
  <li>directory structure of a rails project</li>
  <li>how to manage data with a database</li>
  <li>use already available components to handle common tasks</li>
  <li>add CRUD resources</li>
  <li>improve the app flawlessy</li>
</ul>

<h2 id="quick-setup">Quick setup</h2>

<p>The following section offers a very quick overview of the tools you need to get started with Ruby on Rails development. If you already have a working rails environment, excluding the default ruby installation that some operating systems have, then feel free to skip the steps.</p>

<h3 id="install-ruby">Install Ruby</h3>

<p>If you run Linux or MacOSX on your computer, you may already have Ruby installed by default, however these kind of installations are out of date (eg: ruby 1.8.x) and <em>gems</em> are difficult to manage. The best way is to install it manually or just use some tool that helps to manage custom Ruby installations, even multiple versions (eg: 1.9.x and 2.0.0 releases).</p>

<p>Instead of repeating what others have already said, I will link some useful guides:</p>

<ul>
  <li>MacOSX: <a href="http://createdbypete.com/articles/ruby-on-rails-development-with-mac-os-x-mountain-lion/">Ruby on Rails development with Mac OS X Mountain Lion</a>. Follow the steps until you reach <em>Install SQLite3</em> section, we’ll see here how to install rails.</li>
  <li>Linux: <a href="http://gorails.com/setup/ubuntu">Setup Ruby On Rails on Ubuntu 13.04</a>. Same as above, follow the steps until you reach <em>Configuring Git</em>.</li>
  <li>Windows: <a href="http://www.ruby-forum.com/topic/4413168">SQLite3 Ruby 2.0 on Windows</a> and <a href="http://kylecordes.com/2008/git-windows-go">Getting Started with Git and GitHub on Windows</a>. I haven’t too much experience on windows, so keep the finger crossed and/or ask on the same forum thread. The Ruby community is very kind :-)</li>
</ul>

<p>Now, you should have all the requirements to get started.</p>

<h3 id="install-bundler-gem">Install Bundler gem</h3>

<p><a href="http://gembundler.com">Bundler</a> is a <a href="http://guides.rubygems.org">Ruby gem</a> that helps you to manage development dependencies in a project. We’ll see how it works later, for now, just install it:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">gem install bundler</code></pre></div>

<h3 id="install-rails-v400-gem">Install Rails v4.0.0 gem</h3>

<p>We’re going to use the upcoming new version of rails. At the time of writing (mid june 2013), it’s the <em>2nd Release Candidate</em> but, according to its author, <a href="https://twitter.com/dhh/status/344819888566702081">it should be enough stable</a>.</p>

<p><strong>EDIT:</strong> rails 4.0.0 is out, so don’t use rc2.</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">gem install rails -v4.0.0</code></pre></div>

<h2 id="a-simple-web-application-to-manage-and-share-bookmarks">A simple web application to manage and share bookmarks</h2>

<p>Someone says that <em>doing it is the best way to learn</em>, so here’s a <em>less common</em> tutorial app: a simple platform to manage or share bookmarks. It’s nothing fancy, but it’s enough to apply some basic concepts. Moreover, aren’t you bored about <em>todo lists</em> and <em>blog engines</em> over and over? :-)</p>

<h3 id="create-the-rails-app">Create the rails app</h3>

<p>When you install rails, it comes with a bunch of other libraries and/or command line tools. The main one is <code>rails</code>. For now, we’ll use it to generate the initial skeleton:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">rails new bookmarks -T -d sqlite3 -B</code></pre></div>

<p>I’ve also passed some arguments to the command:</p>

<ul>
  <li><code>-T</code>: skip <code>Test::Unit</code> files. It’s not fundamental for our purposes (but they are in the everyday Ruby <em>and</em> Rails development), so I skipped them because <em>testing</em> is an argument apart and I don’t want to overcomplicate this article.</li>
  <li><code>-d sqlite3</code>: we want to use <a href="http://www.sqlite.org">SQLite</a> database. It fits perfectly for our purposes. Please note that, Rails has support for a wide variety of databases, even NoSQL ones. It’s also common to have different database engines based on the environment (eg: SQLite for development, MySQL or PostgreSQL for production, etc…) without code changes.</li>
  <li><code>-B</code>: don’t run <code>bundle install</code>, we’ll do it manually later.</li>
</ul>

<p>Once you run the command, you should see a long list of lines that explain what is happening:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">andrea</span><span class="vi">@mbair</span> <span class="o">~</span><span class="sr">/Works/</span><span class="mi">12</span><span class="n">dos</span> <span class="o">%</span> <span class="n">rails</span> <span class="kp">new</span> <span class="n">bookmarks</span> <span class="o">-</span><span class="n">T</span> <span class="o">-</span><span class="n">d</span> <span class="n">sqlite3</span> <span class="o">-</span><span class="n">B</span>
    <span class="n">create</span>
    <span class="n">create</span>  <span class="no">README</span><span class="o">.</span><span class="n">rdoc</span>
    <span class="n">create</span>  <span class="no">Rakefile</span>
    <span class="n">create</span>  <span class="n">config</span><span class="o">.</span><span class="n">ru</span>
    <span class="n">create</span>  <span class="o">.</span><span class="n">gitignore</span>
    <span class="n">create</span>  <span class="no">Gemfile</span>
    <span class="n">create</span>  <span class="n">app</span>
    <span class="o">[.</span><span class="n">.</span><span class="o">.]</span>
<span class="n">andrea</span><span class="vi">@mbair</span> <span class="o">~</span><span class="sr">/Works/</span><span class="mi">12</span><span class="n">dos</span> <span class="o">%</span> <span class="n">cd</span> <span class="n">bookmarks</span>
<span class="n">andrea</span><span class="vi">@mbair</span> <span class="o">~</span><span class="sr">/Works/</span><span class="mi">12</span><span class="n">dos</span><span class="o">/</span><span class="n">bookmarks</span> <span class="o">%</span></code></pre></div>

<p>A new directory called <code>bookmarks</code> (or whatever name you passed) has been created, along with a set of files and directories inside it. Enter this directory, we’ll see the important contents during the article.</p>

<h3 id="a-first-look-at-bundler-and-gemfile">A first look at Bundler and Gemfile</h3>

<p>We mentioned Bundler as a tool to manage development dependencies in a Ruby app. It works by reading a file called <code>Gemfile</code> that should be present in the root directory of the app. You need this to make sure all the required gems are installed, even rails itself. Here’s a brief look at the Gemfile generated by the <code>rails new</code> command:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="c1"># Our rails version</span>
<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.0&#39;</span>

<span class="c1"># Use sqlite3 as the database for Active Record</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span>

<span class="c1"># Use SCSS for stylesheets</span>
<span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 4.0.0&#39;</span>

<span class="c1"># Use Uglifier as compressor for JavaScript assets</span>
<span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;= 1.3.0&#39;</span>

<span class="c1"># Use CoffeeScript for .js.coffee assets and views</span>
<span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 4.0.0</span>

<span class="s1"># Uncomment this if you haven&#39;</span><span class="n">t</span> <span class="n">a</span> <span class="n">nodejs</span> <span class="ow">and</span> <span class="n">coffeescript</span> <span class="n">installed</span>
<span class="c1"># gem &#39;therubyracer&#39;, platforms: :ruby</span>

<span class="o">[.</span><span class="n">.</span><span class="o">.]</span></code></pre></div>

<p>As you can see, this is the default list of gems you need to start working on a Rails project. Of course, you’ll change it very often to add, remove or upgrade gems.</p>

<p>Now you can finally run <code>bundle install</code> (the command we skipped by specifying <code>-B</code>):</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">andrea</span><span class="vi">@mbair</span> <span class="o">~</span><span class="sr">/Works/</span><span class="mi">12</span><span class="n">dos</span><span class="o">/</span><span class="n">bookmarks</span> <span class="o">%</span> <span class="n">bundle</span> <span class="n">install</span>
<span class="no">Fetching</span> <span class="n">gem</span> <span class="n">metadata</span> <span class="n">from</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">rubygems</span><span class="o">.</span><span class="n">org</span><span class="o">/.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
<span class="no">Fetching</span> <span class="n">gem</span> <span class="n">metadata</span> <span class="n">from</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">rubygems</span><span class="o">.</span><span class="n">org</span><span class="o">/.</span><span class="n">.</span>
<span class="no">Resolving</span> <span class="n">dependencies</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="no">Using</span> <span class="n">rake</span> <span class="p">(</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">4</span><span class="p">)</span>
<span class="no">Installing</span> <span class="n">i18n</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">6</span><span class="o">.</span><span class="mi">4</span><span class="p">)</span>
<span class="o">[.</span><span class="n">.</span><span class="o">.]</span>
<span class="no">Your</span> <span class="n">bundle</span> <span class="n">is</span> <span class="n">complete!</span>
<span class="no">Use</span> <span class="sb">`bundle show [gemname]`</span> <span class="n">to</span> <span class="n">see</span> <span class="n">where</span> <span class="n">a</span> <span class="n">bundled</span> <span class="n">gem</span> <span class="n">is</span> <span class="n">installed</span><span class="o">.</span>
<span class="n">andrea</span><span class="vi">@mbair</span> <span class="o">~</span><span class="sr">/Works/</span><span class="mi">12</span><span class="n">dos</span><span class="o">/</span><span class="n">bookmarks</span> <span class="o">%</span></code></pre></div>

<p>If you use <em>git</em>, this is a good moment to initialize the repo and proceed with the initial commit.</p>

<h3 id="run-the-development-server">Run the development server</h3>

<p>Even if you haven’t yet wrote any line of code, you can already use the Rails development server. Run the following command:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">andrea@mbair ~/Works/12dos/bookmarks % rails <span class="nv">server</span>
<span class="o">=</span>&gt; Booting <span class="nv">WEBrick</span>
<span class="o">=</span>&gt; Rails 4.0.0 application starting in development on http://0.0.0.0:3000
<span class="o">=</span>&gt; Run <span class="sb">`</span>rails server -h<span class="sb">`</span> <span class="k">for</span> more startup <span class="nv">options</span>
<span class="o">=</span>&gt; Ctrl-C to shutdown server
<span class="o">[</span>2013-06-14 16:10:48<span class="o">]</span> INFO  WEBrick 1.3.1
<span class="o">[</span>2013-06-14 16:10:48<span class="o">]</span> INFO  ruby 1.9.3 <span class="o">(</span>2012-04-20<span class="o">)</span> <span class="o">[</span>x86_64-darwin12.2.0<span class="o">]</span>
<span class="o">[</span>2013-06-14 16:10:48<span class="o">]</span> INFO  WEBrick::HTTPServer#start: <span class="nv">pid</span><span class="o">=</span><span class="m">1174</span> <span class="nv">port</span><span class="o">=</span>3000
<span class="o">[</span>...<span class="o">]</span></code></pre></div>

<p>then point your browser to <a href="http://localhost:3000">http://localhost:3000</a> and you’ll get a standard welcome page. This time we’ve used <code>rails server</code>, another useful command offered by Rails, moreover, it works only when you run it inside a Rails project folder. We’ll see other useful commands later.</p>

<h2 id="a-quick-introduction-to-mvc-patterns-and-rails">A quick introduction to MVC patterns and Rails</h2>

<p>Rails is usually defined as an <em>MVC framework</em>. Basically, it means that the app behaviour is defined in this way:</p>

<ul>
  <li><strong>Model:</strong> manages data between the rest of the application and the database. You can define how a single entity behaves, this includes data validation, before/after save hooks, etc…</li>
  <li><strong>Controller:</strong> this is the <em>glue</em> between the data managed by the Models and the rendered Views. Http requests that come to your app, are <em>routed</em> to a controller which usually will interact with one or more models and finally renders the ouput along with an Http response.</li>
  <li><strong>View:</strong> the final output for a request. It’s usually a piece of HTML, but it might also be JSON or XML. We’ll see this later.</li>
</ul>

<p>This is, of course, an over-simplification, but it should be enough to get a <em>vague idea</em> of how it works. I’ll dive into some details later.</p>

<h2 id="add-a-bookmark-resource">Add a Bookmark resource</h2>

<p>The goal of our app is to manage bookmarks, right? So we create our <code>Bookmark</code> resource:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">andrea@mbair ~/Works/12dos/bookmarks % rails generate scaffold bookmark title:string url:string
    invoke    active_record
    create    db/migrate/20130614142337_create_bookmarks.rb
    create    app/models/bookmark.rb
    invoke    resource_route
     route    resources :bookmarks
    invoke    scaffold_controller
    create    app/controllers/bookmarks_controller.rb
    <span class="o">[</span>...<span class="o">]</span></code></pre></div>

<p>This time, we’ve used <code>rails generate</code>, one of the most useful commands. In this case, we’ve generated a <em>scaffold</em> that creates all the necessary files and code to automatically get a full <em>MVC</em> stack that manages a <em>Bookmark</em>. In the next paragraphs, we’ll see in detail what did the above command.</p>

<h3 id="database-migration">Database migration</h3>

<p>We’ve specified that a <em>Bookmark</em> record is made of a <em>title</em> and a <em>url</em> fields, both of type <em>string</em> (255 chars by default). So, the rails scaffold generator has automatically created a <em>migration</em> script to update your database schema: <code>db/migrate/db/migrate/20130614142337_create_bookmarks.rb</code></p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CreateBookmarks</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:bookmarks</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:title</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:url</span>

      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Even if it’s almost easy to read, this code basically means:</p>

<ul>
  <li>create a <code>bookmarks</code> table on database (note the pluralized form)</li>
  <li>it has the fields <code>title</code> and <code>url</code> of type string</li>
  <li>also add timestmps by default (this is automatically translated to <code>created_at</code> and <code>updated_at</code> datetime fields)</li>
</ul>

<p>However, your database still doesn’t know about these changes to the schema, you need to run the migration task:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">andrea@mbair ~/Works/12dos/bookmarks % rake db:migrate
<span class="o">==</span>  CreateBookmarks: <span class="nv">migrating</span> <span class="o">================================================</span>
-- create_table<span class="o">(</span>:bookmarks<span class="o">)</span>
   -&gt; 0.0011s
<span class="o">==</span>  CreateBookmarks: migrated <span class="o">(</span>0.0012s<span class="o">)</span> <span class="o">=======================================</span></code></pre></div>

<p><a href="http://rake.rubyforge.org">Rake</a> is another common and useful tool in the Ruby world. It acts like a <em>Makefile</em> in a Ruby fashion. Rails comes with several <em>rake</em> tasks ready to use (you can also create custom ones, if needed):</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">andrea@mbair ~/Works/12dos/bookmarks % rake -T
rake about                  <span class="c"># List versions of all Rails frameworks and the environment</span>
rake assets:clean           <span class="c"># Remove old compiled assets</span>
rake assets:clobber         <span class="c"># Remove compiled assets</span>
rake assets:environment     <span class="c"># Load asset compile environment</span>
<span class="o">[</span>...<span class="o">]</span></code></pre></div>

<h3 id="the-boomark-model">The Boomark model</h3>

<p>The model representing a <em>bookmark</em> was created in <code>app/models/bookmark.rb</code>, at the moment it’s almost empty in terms of code, but it already knows how to behave with the database. To demonstrate this, we’ll use another Rails command to open a <em>console</em>:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">andrea@mbair ~/Works/12dos/bookmarks % rails console
Loading development environment <span class="o">(</span>Rails 4.0.0<span class="o">)</span>
&gt;</code></pre></div>

<p>Now, we have a shell to manually issue commands to our rails app. Let’s see if it knows something about our <em>Bookmark</em>:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&gt;</span> <span class="no">Bookmark</span>
<span class="o">=&gt;</span> <span class="no">Bookmark</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">integer</span><span class="p">,</span> <span class="ss">title</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span> <span class="ss">url</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span> <span class="ss">created_at</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="ss">updated_at</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="no">Bookmark</span><span class="o">.</span><span class="n">count</span>
     <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="no">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="no">FROM</span> <span class="s2">&quot;bookmarks&quot;</span>
<span class="o">=&gt;</span> <span class="mi">0</span></code></pre></div>

<p>It knows about the <em>bookmarks</em> table, its fields and how to query the database. Ok, create one <em>Bookmark</em>:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&gt;</span> <span class="no">Bookmark</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">title</span><span class="p">:</span> <span class="s2">&quot;Hello Bookmarks app!&quot;</span><span class="p">,</span> <span class="ss">url</span><span class="p">:</span> <span class="s2">&quot;http://localhost:3000&quot;</span><span class="p">)</span>
   <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="n">ms</span><span class="p">)</span>  <span class="k">begin</span> <span class="n">transaction</span>
  <span class="no">SQL</span> <span class="p">(</span><span class="mi">7</span><span class="o">.</span><span class="mi">7</span><span class="n">ms</span><span class="p">)</span>  <span class="no">INSERT</span> <span class="no">INTO</span> <span class="s2">&quot;bookmarks&quot;</span> <span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;updated_at&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">)</span> <span class="no">VALUES</span> <span class="p">(</span><span class="sc">?,</span> <span class="sc">?,</span> <span class="sc">?,</span> <span class="sc">?)</span>  <span class="o">[[</span><span class="s2">&quot;created_at&quot;</span><span class="p">,</span> <span class="no">Fri</span><span class="p">,</span> <span class="mi">14</span> <span class="no">Jun</span> <span class="mi">2013</span> <span class="mi">15</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">17</span> <span class="no">UTC</span> <span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello Bookmarks app!&quot;</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;updated_at&quot;</span><span class="p">,</span> <span class="no">Fri</span><span class="p">,</span> <span class="mi">14</span> <span class="no">Jun</span> <span class="mi">2013</span> <span class="mi">15</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">17</span> <span class="no">UTC</span> <span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost:3000&quot;</span><span class="o">]]</span>
   <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="n">ms</span><span class="p">)</span>  <span class="n">commit</span> <span class="n">transaction</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Bookmark id: 1, title: &quot;Hello Bookmarks app!&quot;, url: &quot;http://localhost:3000&quot;, created_at: &quot;2013-06-14 15:16:17&quot;, updated_at: &quot;2013-06-14 15:16:17&quot;</span>

<span class="o">&gt;</span> <span class="no">Bookmark</span><span class="o">.</span><span class="n">count</span>
     <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="no">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="no">FROM</span> <span class="s2">&quot;bookmarks&quot;</span>
<span class="o">=&gt;</span> <span class="mi">1</span></code></pre></div>

<h3 id="the-bookmarkscontroller-and-its-views">The BookmarksController and its views</h3>

<p>We said that the <em>scaffold generator</em> has created all the parts of the MVC stack, now is the time for the controller in <code>app/controllers/bookmarks_controller.rb</code>. You’ll see a <code>BookmarksController</code> class and a bunch of methods (called <em>actions</em>). Each action corresponds to an HTTP PATH (eg: <code>/bookmarks</code>) and an HTTP verb (GET, POST, PUT, DELETE).</p>

<p>The autogenerated code is quite clear and, for brevity reasons, I can’t dive too much in it. The interesting parts are:</p>

<ul>
  <li>nowhere in the code is specified how to render views. There’s a reason for that: html views are based on the controller’s actions names. For example, <code>BookmarksController#show</code> will render a template placed in <code>app/views/bookmarks/show.html.erb</code>. Of course, only the actions that respond to <em>HTTP GET</em> have a template, the rest are usually redirects. Check yourself the contents in <code>app/views/bookmarks/</code> to get an idea.</li>
  <li>it looks like there’s some automagical <em>JSON</em> support. That’s true, rails supports <em>HTML</em> and <em>JSON</em> request by default, I’ll show you this later.</li>
</ul>

<h3 id="routes">Routes</h3>

<p>The final component for the <em>MVC</em> stack is about routing the <em>HTTP</em> requests to the proper controller and action. To make this, the Rails generator has updated <code>config/routes.rb</code> file and has added the line <code>resources :bookmarks</code> that is a shorthand to say: <em>use <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">REST</a> routes for the the resource bookmark</em>. If you’re wondering <em>what</em> routes, you can use the relative <em>rake task</em>:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">andrea@mbair ~/Works/12dos/bookmarks % rake routes
       Prefix Verb   URI Pattern                   Controller#Action
    bookmarks GET    /bookmarks<span class="o">(</span>.:format<span class="o">)</span>          bookmarks#index
              POST   /bookmarks<span class="o">(</span>.:format<span class="o">)</span>          bookmarks#create
 new_bookmark GET    /bookmarks/new<span class="o">(</span>.:format<span class="o">)</span>      bookmarks#new
edit_bookmark GET    /bookmarks/:id/edit<span class="o">(</span>.:format<span class="o">)</span> bookmarks#edit
     bookmark GET    /bookmarks/:id<span class="o">(</span>.:format<span class="o">)</span>      bookmarks#show
              PATCH  /bookmarks/:id<span class="o">(</span>.:format<span class="o">)</span>      bookmarks#update
              PUT    /bookmarks/:id<span class="o">(</span>.:format<span class="o">)</span>      bookmarks#update
              DELETE /bookmarks/:id<span class="o">(</span>.:format<span class="o">)</span>      bookmarks#destroy</code></pre></div>

<h3 id="try-on-the-server">Try on the server</h3>

<p>Now, the fun part. Restart your rails server with <code>rails server</code> and go to <a href="http://localhost:3000/bookmarks">http://localhost:3000/bookmarks</a>. If you followed the above example in console, you should already see the Bookmark created earlier, otherwise, you can create a new one by clicking on <em>New bookmark</em> link.</p>

<p>Try <a href="http://localhost:3000/bookmarks.json">http://localhost:3000/bookmarks.json</a> and see what you’ll get. You still haven’t written a single line of Ruby, and it already does a lot of things. Awesome, isn’t it? :-)</p>

<h2 id="adding-users-and-authentication">Adding users and authentication</h2>

<p>Once we have the <em>Bookmark</em> resource, we need <em>Users</em> that own bookmarks and a way to authenticate them. The Ruby and Rails community is very active: whatever the task is, you’ll probably find at least one gem to do it (if you don’t, it might be a good idea to write one). Luckily, user authentication is a very common task, and there are several options. The most used is <a href="https://github.com/plataformatec/devise">Devise</a>, let’s use it.</p>

<h3 id="installing-devise-gem">Installing Devise gem</h3>

<p>Open <code>Gemfile</code> and add this line:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">&#39;devise&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 3.0.0.rc&#39;</span></code></pre></div>

<p>We also told Bundler to use a version of Devise that should be <em>greater_or_equal</em> than its <em>minor version</em> (eg: 3.0.1 is ok, 3.1.0 isn’t).</p>

<p>Run <code>bundle install</code> to install the gem:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">andrea@mbair ~/Works/12dos/bookmarks % bundle install
Resolving dependencies...
Using rake <span class="o">(</span>10.0.4<span class="o">)</span>
<span class="o">[</span>...<span class="o">]</span>
Installing devise <span class="o">(</span>3.0.0.rc<span class="o">)</span>
<span class="o">[</span>...<span class="o">]</span>
Your bundle is <span class="nb">complete</span>!
Use <span class="sb">`</span>bundle show <span class="o">[</span>gemname<span class="o">]</span><span class="sb">`</span> to see where a bundled gem is installed.
andrea@mbair ~/Works/12dos/bookmarks %</code></pre></div>

<p>and run the Devise generator:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">andrea@mbair ~/Works/12dos/bookmarks % rails generate devise:install
      create  config/initializers/devise.rb
      create  config/locales/devise.en.yml
<span class="o">===============================================================================</span>

Some setup you must <span class="k">do</span> manually <span class="k">if</span> you haven<span class="err">&#39;</span>t yet:

  1. Ensure you have defined default url options in your environments files. Here
     is an example of default_url_options appropriate <span class="k">for</span> a development environment
     in config/environments/development.rb:

       config.action_mailer.default_url_options <span class="o">=</span> <span class="o">{</span> :host <span class="o">=</span>&gt; <span class="s2">&quot;localhost:3000&quot;</span> <span class="o">}</span>

     In production, :host should be <span class="nb">set </span>to the actual host of your application.

  2. Ensure you have defined root_url to *something* in your config/routes.rb.
     For example:

       root :to <span class="o">=</span>&gt; <span class="s2">&quot;home#index&quot;</span>

  3. Ensure you have flash messages in app/views/layouts/application.html.erb.
     For example:

       &lt;p <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;notice&quot;</span>&gt;&lt;%<span class="o">=</span> notice %&gt;&lt;/p&gt;
       &lt;p <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span>&gt;&lt;%<span class="o">=</span> alert %&gt;&lt;/p&gt;

  4. If you are deploying Rails 3.1+ on Heroku, you may want to <span class="nb">set</span>:

       config.assets.initialize_on_precompile <span class="o">=</span> <span class="nb">false</span>

<span class="nb">     </span>On config/application.rb forcing your application to not access the DB
     or load models when precompiling your assets.

  5. You can copy Devise views <span class="o">(</span><span class="k">for</span> customization<span class="o">)</span> to your app by running:

       rails g devise:views

<span class="o">===============================================================================</span>
andrea@mbair ~/Works/12dos/bookmarks %</code></pre></div>

<p>As you can see, it has created two files under <code>config/</code> directory:</p>

<ul>
  <li><code>config/initializers/devise.rb</code>: here you can change several Devise settings. However, we’ll use defaults because are enough.</li>
  <li><code>config/locales/devise.en.yml</code>: this file contains i18n translations for Devise. Please note that <code>config/locales/</code> is the default path to put all the locales for a Rails app.</li>
</ul>

<p>Devise also told us to check five steps to complete the setup:</p>

<ul>
  <li>add <code>config.action_mailer.default_url_options = { :host =&gt; 'localhost:3000' }</code> to <code>config/environments/development.rb</code></li>
  <li>define a <em>root_url</em> in <code>config/routes.rb</code>. Fow now, we can achieve this by pointing <code>BookmarksController#index</code> to the root of the site:</li>
</ul>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Bookmarks</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="c1"># [...]</span>
  <span class="n">root</span> <span class="s1">&#39;bookmarks#index&#39;</span>

  <span class="c1"># [...]</span>
<span class="k">end</span></code></pre></div>

<ul>
  <li>
    <p>add the two pieces of html in <code>app/views/layouts/application.html.erb</code>. This file is the main layout your Rails app.</p>
  </li>
  <li>skip the fourth step because we’re running a Rails v4.0.x app, not a 3.1.x one)</li>
  <li>generate the Devise default views with <code>rails generate devise:views</code>. They contain a basic scaffold to get Devise work (eg: login/signup forms, etc…). Please note that Devise has several features concerning user authentication and registration, but we’re going to use only a small set of them, so don’t panic if you see a lot of generated views.</li>
</ul>

<h3 id="generate-a-user-model">Generate a User model</h3>

<p>Setup for Devise is done, but we still haven’t a <em>User</em> model, we need to create one:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">andrea@mbair ~/Works/12dos/bookmarks % rails generate devise User
      invoke    active_record
      create    db/migrate/20130617132545_devise_create_users.rb
      create    app/models/user.rb
      insert    app/models/user.rb
       route    devise_for :users</code></pre></div>

<p>If you remember the scaffold generator we used to generate a <em>Bookmark</em>, this one is very similar even if just focused on the model, plus the route that tells Devise to handle <code>/users/*</code> paths. In fact, it created a migration for users and the <em>User</em> class. Edit the migration to look like this (remove or comment the rest):</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">DeviseCreateUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="c1">## Database authenticatable</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:email</span><span class="p">,</span>              <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:encrypted_password</span><span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span>

      <span class="c1">## Rememberable</span>
      <span class="n">t</span><span class="o">.</span><span class="n">datetime</span> <span class="ss">:remember_created_at</span>

      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
    <span class="k">end</span>

    <span class="n">add_index</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span>                <span class="ss">:unique</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Also the model needs to reflect the changes made to the migration:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">devise</span> <span class="ss">:database_authenticatable</span><span class="p">,</span> <span class="ss">:registerable</span><span class="p">,</span>
         <span class="ss">:rememberable</span><span class="p">,</span> <span class="ss">:validatable</span>
<span class="k">end</span></code></pre></div>

<p>The last step, is to run the migration with <code>rake db:migrate</code></p>

<p>In this way, we have a simple authentication system that lets a user to register, login and logout. Try to run <code>rake routes</code> and you’ll see the new routes for these actions, all referred to <em>users</em>. You can also play in the Rails console to create some user.</p>

<h3 id="user-has-many-bookmarks">User has many Bookmarks</h3>

<p>Now that we have <em>User</em> and <em>Bookmark</em>, we need to <em>associate</em> them. In this case, it’s a <em>one to many</em> relation. As a shared convention, foreign keys name are made of the model name suffixed by _id. Of course, we’ll not change the already created migrations, instead, we’re going to create a new one:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">rails</span> <span class="n">generate</span> <span class="n">migration</span> <span class="no">AddUserIdToBookmark</span> <span class="ss">user_id</span><span class="p">:</span><span class="n">integer</span></code></pre></div>

<p>Choosing an appropriate, arbitrary name is not mandatory, but it’s a <em>best practice</em> that you should follow. Our generated migration will add a <em>user_id</em> integer column to the <em>bookmarks</em> table. Also, feel free to run the migration now.</p>

<p>At the moment, no one of our two rails models knows about each other, we’ve only added a field on the database, but it’s meaningless without some additional instruction:</p>

<ul>
  <li>add <code>has_many :bookmarks</code> to <code>app/models/user.rb</code></li>
  <li>add <code>belongs_to :user</code> to <code>app/models/bookmark.rb</code></li>
</ul>

<p>With these changes, a <code>User</code> instance will automatically have a <code>bookmarks</code> method (and many others), referred to all <em>Bookmark</em> records with that specific <em>user id</em>.</p>

<h3 id="require-authentication-to-manage-your-bookmarks">Require authentication to manage your bookmarks</h3>

<p>Looking at the models, it looks like the <em>data part</em> is complete and working. However, the <code>BookmarksController</code> created by the scaffold command doesn’t apply any authentication check, it needs some fix.</p>

<p>First of all, check user authentication before executing whatever action:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">BookmarksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># other before_actions</span>
  <span class="n">before_action</span> <span class="ss">:authenticate_user!</span>

  <span class="c1"># [...] actions</span>
<span class="k">end</span></code></pre></div>

<p>This means that, from now, each request that arrives to the <code>BookmarksController</code> will first check if a user is authenticated (<code>authenticate_user!</code> is a method provided by Devise), otherwise it will be redirected to the login page.</p>

<p>Then, access only bookmarks owned by the authenticated user. To do this, replace <code>Bookmark</code> occurrencies with <code>current_user.bookmarks</code>. As you may wonder, <code>current_user</code> is an object provided by Devise that represents the authenticated user, while <code>.bookmarks</code> is the method provided by the model association between  <em>User</em> and <em>Bookmark</em> models.</p>

<h3 id="try-on-the-server-1">Try on the server</h3>

<p>If you didn’t played with the web interface yet, now it’s a good time to do it. Here there’re some hints:</p>

<ul>
  <li>go to <a href="http://localhost:3000">http://localhost:3000</a>, it should redirect to <a href="http://localhost:3000/users/sign_in">http://localhost:3000/users/sign_in</a>, the login page;</li>
  <li>if you haven’t registered any user, then go to <a href="http://localhost:3000/users/sign_up">http://localhost:3000/users/sign_up</a> and register a new one;</li>
  <li>retry to go to <a href="http://localhost:3000/">http://localhost:3000/</a> again, it will work as well as going to <a href="http://localhost:3000/bookmarks">http://localhost:3000/bookmarks</a> because they’re the same action;</li>
  <li>create some bookmarks from <a href="http://localhost:3000/bookmarks/new">http://localhost:3000/bookmarks/new</a>.</li>
</ul>

<h2 id="handling-wrong-inputs">Handling wrong inputs</h2>

<p>At the moment, we have several areas where a wrong user input might damage you application:</p>

<ul>
  <li>providing incomplete or malformed data when creating a new Bookmark</li>
  <li>requesting a bookmark id that doesn’t exist as a record on the database, for example by visiting <a href="http://localhost:3000/bookmarks/111">http://localhost:3000/bookmarks/111</a>, will cause an error in your app, very ugly to see.</li>
</ul>

<p>Let’s see how to solve these issues.</p>

<h3 id="model-validations">Model validations</h3>

<p>If you tried to use a password shorter than 8 chars or a bad formatted email during user registrations, you’d note that Devise has spotted those errors by not saving the record and rendering the user registration form again. In fact, Devise provided some default validations for users, but our app need validations on the <code>Bookmark</code> model too. Change <code>app/models/bookmark.rb</code> to look like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Bookmark</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>

  <span class="c1"># ensure that a user_id is present</span>
  <span class="n">validates</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>

  <span class="c1"># ensure that title is present and at least 10 chars long</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">minimum</span><span class="p">:</span> <span class="mi">10</span> <span class="p">},</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>

  <span class="c1"># ensure the url is present, and respects the URL format for http/https</span>
  <span class="n">validates</span> <span class="ss">:url</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="p">{</span><span class="ss">with</span><span class="p">:</span> <span class="no">Regexp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">URI</span><span class="o">::</span><span class="n">regexp</span><span class="p">(</span><span class="sx">%w(http https)</span><span class="p">))},</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span></code></pre></div>

<p>These validations are self-explanatory, so I’ll not dive into them. Just keep in mind that there are many others or, in case, you can create custom ones.</p>

<h3 id="when-a-resource-is-not-found">When a resource is not found…</h3>

<p>The second problem we addressed is about passing a wrong/non-existent identifier for a given resource. You can handle it in many ways, perhaps the simplest (and laziest) one is to redirect to the index, with a <em>flash message</em>. To do this, we only need to change some line of code in <code>BookmarksController</code>:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">BookmarksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># [...] other code here</span>

  <span class="kp">private</span>
    <span class="c1"># Use callbacks to share common setup or constraints between actions.</span>
    <span class="k">def</span> <span class="nf">set_bookmark</span>
      <span class="k">unless</span> <span class="vi">@bookmark</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">bookmarks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
        <span class="n">flash</span><span class="o">[</span><span class="ss">:alert</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;Bookmark not found.&#39;</span>
        <span class="n">redirect_to</span> <span class="n">root_url</span>
      <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>The <code>set_bookmark</code> is a method called in a <em>before_action</em> only for actions that need a resource id (show, edit, update, destroy). The new lines will safely check for existence on database, otherwise the user will be redirected to the root path of the site, with a short flash message.</p>

<h2 id="improving-the-app-one-step-at-a-time">Improving the app one step at a time</h2>

<p>Our app is almost complete, or at leats, it lacks several little details that make a difference. We’ll try to address some of these. The goal, is to demostrate how to improve an existing app with small steps.</p>

<h3 id="add-a-better-root-page">Add a better root page</h3>

<p>This is a simple task. All we need is a new route, controller and view. This time, we’ll use a generator dedicated to the controller:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">rails generate controller site index</code></pre></div>

<p>I’ve omitted the output because at the moment you should already guess what it did. In short, it has created a <code>SiteController</code> with an action called <code>index</code>, plus the related view in <code>app/views/site/index.html.erb</code> and a new route in <code>config/routes.rb</code>. However, the route should be changed to reflect our goal:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Bookmarks</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span>
  <span class="c1"># [...] other routes</span>

  <span class="c1"># Comment/remove these lines</span>
  <span class="c1"># get &quot;site/index&quot;</span>
  <span class="c1"># root &#39;bookmarks#index&#39;</span>

  <span class="c1"># Use this</span>
  <span class="n">root</span> <span class="s1">&#39;site#index&#39;</span>
<span class="k">end</span></code></pre></div>

<p>If you try to load <a href="http://localhost:3000">http://localhost:3000</a> you’ll see the empty template of <code>app/views/site/index.html.erb</code>. To render content, we need to change the controller in <code>app/controllers/site_controller.rb</code>:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">SiteController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="c1"># retrieve all Bookmarks ordered by descending creation timestamp</span>
    <span class="vi">@bookmarks</span> <span class="o">=</span> <span class="no">Bookmark</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;created_at desc&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>while the view in <code>app/views/site/index.html.erb</code>, might  contain this basic markup as a starting point:</p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;h2&gt;Latest Bookmarks&lt;/h2&gt;</span>
<span class="x">&lt;table style=&quot;width: 100%&quot;&gt;</span>
<span class="x">  &lt;thead&gt;</span>
<span class="x">    &lt;tr&gt;</span>
<span class="x">      &lt;th&gt;Url&lt;/th&gt;</span>
<span class="x">    &lt;/tr&gt;</span>
<span class="x">  &lt;/thead&gt;</span>

<span class="x">  &lt;tbody&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="vi">@bookmarks</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">bookmark</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;tr&gt;</span>
<span class="x">      &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">bookmark</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">bookmark</span><span class="o">.</span><span class="n">url</span> <span class="cp">%&gt;</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;/tr&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/tbody&gt;</span>
<span class="x">&lt;/table&gt;</span></code></pre></div>

<p>Again, note how the controller processes the request by retrieving some records from the database through the model <code>Bookmark</code>, then renders its view that contains the proper data to show the bookmarks.</p>

<h3 id="prettier-gui">Prettier GUI</h3>

<p>Being a programmer, I haven’t too much skills in design and layouts, but there are several CSS frameworks that help a lot. Instead of picking the famous <a href="http://twitter.github.io/bootstrap/">Twitter Bootstrap</a>, I chose <a href="http://foundation.zurb.com">ZURB Foundation</a>, just to be fancy. There are a lot of ways to integrate existing CSS/Javascript frameworks and libraries inside a Rails app, the simplest one, is to use a gem when possible. Luckily, there’s one for Zurb Foundation, just add it to your Gemfile:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">&#39;zurb-foundation&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 4.2.2&#39;</span></code></pre></div>

<p>run <code>bundle install</code>, plus its install generator:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">rails generate foundation:install</code></pre></div>

<p>this command, will ask you to overwrite your default application layout in <code>app/views/layouts/application.html.erb</code>, press <em>Y</em> without worries. For brevity reasons, I’ve put the contents of the file <a href="https://gist.github.com/apeacox/87e2c7261abeeb1ccf9d">here</a>.</p>

<p>Moreover, we can also remove old scaffold’s stylesheets:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">rm app/assets/stylesheets/scaffolds.css.scss</code></pre></div>

<h3 id="prettier-forms">Prettier forms</h3>

<p>Forms are still ugly and boring to write, so we’ll use <a href="https://github.com/plataformatec/simple_form">another useful gem</a> (from the same authors of <em>Devise</em>) to mitigate the problem. Add it to your Gemfile:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">&#39;simple_form&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 3.0.0.rc&#39;</span></code></pre></div>

<p>run <code>bundle install</code> and the install generator (note that it already supports Foundation’s markup structure):</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">rails generate simple_form:install --foundation</code></pre></div>

<p>We’ll also re-generate <em>Devise</em> views, because it supports <em>SimpleForm</em>:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">rails generate devise:views</code></pre></div>

<p>The generator will ask you if you want to overwrite existent files, press <em>Y</em> because that’s what we really want.</p>

<p>The last step is to fix the <em>Bookmarks</em> form, it wasn’t updated by the other generators, we’ll do it manually by overwriting its (partial) template in <code>app/views/bookmarks/_form.html.erb</code> with the following content:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="sx">%= simple_form_for(@bookmark) do |f| %&gt;</span>
<span class="sx">  &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">error_notification</span> <span class="sx">%&gt;</span>

<span class="sx">  &lt;div class=&quot;form-inputs&quot;&gt;</span>
    <span class="o">&lt;</span><span class="sx">%= f.input :title %&gt;</span>
<span class="sx">    &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:url</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;/div&gt;</span>

  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-actions&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">button</span> <span class="ss">:submit</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;/div&gt;</span>
<span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span></code></pre></div>

<h3 id="a-welcome-page">A welcome page</h3>

<p>It would be <em>professional</em> to show a welcome page for non-registered users. To keep things simple, I’ll use the same <code>SiteController#index</code> used for the root page. Modify <code>app/views/site/index.html.erb</code> to look like <a href="https://gist.github.com/apeacox/98eeca9a0979c5802eb3">this</a>.</p>

<h2 id="conclusions">Conclusions</h2>

<p>Congratulations! If you carefully followed all the steps, you should have a basic, yet working, Ruby On Rails app. Of course, this is only the <em>tip of the iceberg</em>: for brevity reasons, I’ve oversimplified some concepts, and I’ve skipped several important aspects (eg: using CSS/SASS and Javascript/Coffeescript, testing, deploy, etc…) that you should know if you want to be a proficient Ruby On Rails developer. However, as you can see, this happened to be already a huge article, at least in terms of lenght :-P</p>

<p>I’ve uploaded the <em>complete app</em> on github: <a href="https://github.com/apeacox/12dos-bookmarks">https://github.com/apeacox/12dos-bookmarks</a>. It’s a bit different from the one we wrote here, but it also adds some more features:</p>

<ul>
  <li>pagination with <a href="https://github.com/amatsuda/kaminari">kaminari</a> gem</li>
  <li>use <em>profile pages</em> to show single user’s bookmarks</li>
</ul>

<p>Clone or fork the code and experiment with it.</p>

<h2 id="webography">Webography</h2>
<ul>
  <li><a href="">http://guides.rubyonrails.org</a>: official documentation and guides</li>
  <li><a href="http://railscasts.com">http://railscasts.com</a>: videos (and transcripts)</li>
  <li><a href="http://www.ruby-lang.org/en/documentation/">http://www.ruby-lang.org/en/documentation</a>: Ruby’s official documentation</li>
  <li><a href="https://www.ruby-toolbox.com">https://www.ruby-toolbox.com</a>: a place where to find gems for your tasks</li>
</ul>

<h2 id="bibliography">Bibliography</h2>
<ul>
  <li><a href="http://pragprog.com/book/ruby4/programming-ruby-1-9-2-0">Programming Ruby 1.9 &amp; 2.0 (4th edition): The Pragmatic Programmers’ Guide</a></li>
  <li><a href="http://pragprog.com/book/rails4/agile-web-development-with-rails-4">Agile Web Development with Rails 4</a></li>
  <li><a href="http://pragprog.com/book/jvrails2/crafting-rails-4-applications">Crafting Rails 4 Applications: Expert Practices for Everyday Rails Development</a></li>
  <li><a href="https://leanpub.com/tr4w">The Rails 4 Way</a></li>
</ul>

  </div>

  <footer>
    <h3 class='title'>Enjoyed this article? Share it!</h3>

    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
      <a class="addthis_button_twitter"><i class='fa fa-twitter-square fa-2x'></i></a>
      <a class="addthis_button_linkedin"><i class='fa fa-linkedin-square fa-2x'></i></a>
      <a class="addthis_button_google_plusone_share"><i class='fa fa-google-plus-square fa-2x'></i></a>
      <a class="addthis_button_facebook"><i class='fa fa-facebook-square fa-2x'></i></a>
    </div>
    <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5359113314750bd5"></script>
    <!-- AddThis Button END -->
  </footer>

  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'apeacox';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

  </div>
</article>

      </div>

      <footer class="wrapper-footer">
        <p>made with <span class='heartbeat'>♥</span> by <a href='http://andreapavoni.com'>Andrea Pavoni</a> &copy;2010 - 2016
          <a href="//www.iubenda.com/privacy-policy/207223" class="iubenda-white iubenda-embed" title="Privacy Policy">Privacy Policy</a>
          <script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src = "//cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>
        </p>
      </footer>
    </section>

    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-9419221-5']);
  _gaq.push(['_trackPageview']);
  _gaq.push (['_gat._anonymizeIp']);

  (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
   })();
</script>

  </body>
</html>
